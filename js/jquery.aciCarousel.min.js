
/*
 * aciCarousel jQuery Plugin v1.0
 * http://acoderinsights.ro
 *
 * Copyright (c) 2012 Dragos Ursu
 * Dual licensed under the MIT or GPL Version 2 licenses.
 *
 * Require jQuery Library http://jquery.com
 * + (optional) MouseWheel Plugin (for mouse wheel support) https://github.com/brandonaaron/jquery-mousewheel
 * + (optional) TouchSwipe Plugin (for touch based devices) https://github.com/mattbryson/TouchSwipe-Jquery-Plugin
 *
 * Date: Fri Jun 22 18:40 2012 +0200
 */

(function(a){a.aciCarousel={nameSpace:".aciCarousel"};a.fn.aciCarousel=function(b,c){if(typeof b=="string"){switch(b){case"options":case"index":return a(this)._aciCarousel(b,c)}}return this.each(function(){return a(this)._aciCarousel(b,c)})};a.fn.aciCarousel.defaults={scroll:"ul",element:"li",focus:"li>a",hash:null,attr:"id",inView:null,mainIndex:0,easing:"swing",duration:500,rollIn:null,rollOut:null,fadeIn:null,fadeOut:null,bindMouse:true,bindTouch:true,bindKeyboard:true,beforePrev:null,afterPrev:null,beforeNext:null,afterNext:null};a.fn._aciCarousel=function(j,c){var f=this;var i=a.extend({},a.fn.aciCarousel.defaults,j);var h=function(){if((typeof j=="undefined")||(typeof j=="object")){e()}if(typeof j=="string"){switch(j){case"options":if(f.data("customUi"+a.aciCarousel.nameSpace)){return f.data("options"+a.aciCarousel.nameSpace)}else{return i}case"index":return g(c);case"destroy":d()}}return f};var b=function(m,k,q){var o=null;if(typeof m=="object"){var l=q.index(m);if(l!=-1){o=q.eq(l)}else{if(k.has(m)){o=m.parents("li:first")}}}else{if(m.toString().match(/^[0-9]+$/)){for(var n=0;n<q.length;n++){var p=q.eq(n);if(p.data("index"+a.aciCarousel.nameSpace)==m){o=p;break}}}else{o=q.find(m).parents("li:first")}}return o};var g=function(m){if(f.data("customUi"+a.aciCarousel.nameSpace)){var l=f.data("options"+a.aciCarousel.nameSpace);var k=f.find(l.scroll+":first");var o=k.find("li").slice(1,-1);var n=b(m,k,o);if(n&&n.length){return n.data("index"+a.aciCarousel.nameSpace)}}return null};var d=function(){if(f.data("customUi"+a.aciCarousel.nameSpace)){var l=f.data("options"+a.aciCarousel.nameSpace);f.removeData("customUi"+a.aciCarousel.nameSpace);f.removeData("options"+a.aciCarousel.nameSpace);f.off(a.aciCarousel.nameSpace);var k=f.find(l.scroll+":first");if(l.focus){k.find(l.focus).off(a.aciCarousel.nameSpace)}k.find("li:first,li:last").remove();k.find("li").detach().sort(function(n,m){return a(n).data("index"+a.aciCarousel.nameSpace)-a(m).data("index"+a.aciCarousel.nameSpace)}).removeData("index"+a.aciCarousel.nameSpace).appendTo(k);f.scrollLeft(0).scrollTop(0)}};var e=function(){if(f.data("customUi"+a.aciCarousel.nameSpace)){return}f.data("customUi"+a.aciCarousel.nameSpace,true);f.data("options"+a.aciCarousel.nameSpace,i);var o=f.find(i.scroll+":first");var u=o.find(i.element+":first");var q=(u.css("float")=="left")||(u.css("float")=="right");u=null;var l=function(C,E,H,I,J,A,B){var G=o.find("li").slice(1,-1);var D=b(C,o,G);if(D&&D.length){if(G.get(i.mainIndex)!=D.get(0)){var L=G.length/2;var F=G.eq(i.mainIndex).data("index"+a.aciCarousel.nameSpace)+1;var K=D.data("index"+a.aciCarousel.nameSpace)+1;var z;if(K>F){if((i.mainIndex<=i.inView/2)?F+L>=K:F+L>K){z=K-F}else{z=(F+G.length-K)*-1}}else{if((i.mainIndex<=i.inView/2)?K+L>F:K+L>=F){z=(F-K)*-1}else{z=K+G.length-F}}if(typeof B=="undefined"){B=E?E/Math.abs(z):0}if(typeof I=="undefined"){if(z>0){p(B,H,J,function(){if(A){A()}l(C,E,H,1,J,A,B)})}else{m(B,H,J,function(){if(A){A()}l(C,E,H,-1,J,A,B)})}}else{if(I==1){p(B,H,J,function(){if(A){A()}l(C,E,H,1,J,A,B)})}else{if(I==-1){m(B,H,J,function(){if(A){A()}l(C,E,H,-1,J,A,B)})}}}}}};var x=function(A,z,B){if(i.rollIn){i.rollIn(A,z,B)}};var t=function(A,z,B){if(i.rollOut){i.rollOut(A,z,B)}};var k=function(A,z,B){if(!i.fadeIn||i.fadeIn(A,z,B)){A.fadeTo(0,0).fadeTo(z?z*1.4:0,1)}};var r=function(A,z,B){if(!i.fadeOut||i.fadeOut(A,z,B)){A.fadeTo(z?z:0,0)}};var y=false;var m=function(A,D,B,C){if(y){return}y=true;if(B){B(o.find("li:eq("+i.mainIndex+")"))}else{if(i.beforePrev){i.beforePrev(o.find("li:eq("+i.mainIndex+")"))}}t(o.find("li:eq("+(i.mainIndex+1)+")"),A?A:0,-1);x(o.find("li:eq("+i.mainIndex+")"),A?A:0,-1);k(o.find("li:first"),A,-1);r(o.find("li:eq("+i.inView+")"),A,-1);if(q){var z={"scroll-left":f.scrollLeft()-o.find("li:first").width()}}else{var z={"scroll-top":f.scrollTop()-o.find("li:first").height()}}f.animate(z,{duration:A?A:0,easing:D?D:"linear",complete:function(){o.find("li:first,li:last").remove();var F=o.find("li:first");var E=o.find("li:last");F.before(E);F=o.find("li:first");E=o.find("li:last");o.prepend(E.clone(true));o.append(F.clone(true));t(o.find("li:first"),0,-1);x(o.find("li:eq("+(i.mainIndex+1)+")"),0,-1);r(o.find("li:first"),0,-1);k(o.find("li:eq(1)"),0,-1);if(q){f.scrollLeft(o.find("li:first").width())}else{f.scrollTop(o.find("li:first").height())}y=false;if(C){C(o.find("li:eq("+(i.mainIndex+1)+")"))}else{if(i.afterPrev){i.afterPrev(o.find("li:eq("+(i.mainIndex+1)+")"))}}}})};var p=function(A,D,B,C){if(y){return}y=true;if(B){B(o.find("li:eq("+(i.mainIndex+2)+")"))}else{if(i.beforeNext){i.beforeNext(o.find("li:eq("+(i.mainIndex+2)+")"))}}t(o.find("li:eq("+(i.mainIndex+1)+")"),A?A:0,1);x(o.find("li:eq("+(i.mainIndex+2)+")"),A?A:0,1);r(o.find("li:eq(1)"),A,1);k(o.find("li:eq("+(i.inView+1)+")"),A,1);if(q){var z={"scroll-left":f.scrollLeft()+o.find("li:first").width()}}else{var z={"scroll-top":f.scrollTop()+o.find("li:first").height()}}f.animate(z,{duration:A?A:0,easing:D?D:"linear",complete:function(){o.find("li:first,li:last").remove();var F=o.find("li:first");var E=o.find("li:last");E.after(F);F=o.find("li:first");E=o.find("li:last");o.prepend(E.clone(true));o.append(F.clone(true));t(o.find("li:last"),0,1);x(o.find("li:eq("+(i.mainIndex+1)+")"),0,1);r(o.find("li:last"),0,1);k(o.find("li:eq("+i.inView+")"),0,1);if(q){f.scrollLeft(o.find("li:first").width())}else{f.scrollTop(o.find("li:first").height())}y=false;if(C){C(o.find("li:eq("+(i.mainIndex+1)+")"))}else{if(i.afterNext){i.afterNext(o.find("li:eq("+(i.mainIndex+1)+")"))}}}})};f.find("*").css("outline","none").attr("tabIndex",-1);var v=function(){var C=o.find("li");for(var z=0;z<C.length;z++){var B=C.eq(z);B.data("index"+a.aciCarousel.nameSpace,z);if(z==i.mainIndex){t(B,0)}else{t(B,0)}}var D=C.eq(0);var A=C.eq(-1);o.prepend(A.clone(true));o.append(D.clone(true));if(q){o.width(D.width()*(C.length+2))}else{o.height(D.height()*(C.length+2))}if(!i.inView){if(q){i.inView=Math.floor(f.width()/D.width())}else{i.inView=Math.floor(f.height()/D.height())}}if(i.mainIndex==0){if(q){f.scrollLeft(D.width())}else{f.scrollTop(D.height())}r(o.find("li:eq(0)"),0);r(o.find("li:eq("+(i.inView+1)+")"),0);x(D,0)}else{l(0,0)}};v();var n=false;f.on("focus"+a.aciCarousel.nameSpace,function(){n=true}).on("blur"+a.aciCarousel.nameSpace,function(){n=false}).on("roll"+a.aciCarousel.nameSpace,function(B,z){if(z){var A=(typeof z.duration!="undefined")?z.duration:i.duration;var C=(typeof z.easing!="undefined")?z.easing:i.easing;if(typeof z.object!="undefined"){l(z.object,A,C,z.direction,z.before,z.after)}else{if(typeof z.direction!="undefined"){if(z.direction==-1){m(A,C,z.before,z.after)}else{if(z.direction==1){p(A,C,z.before,z.after)}}}}}}).on("rollPrev"+a.aciCarousel.nameSpace,function(A,z){if(z){z.direction=-1}else{z={direction:-1}}f.trigger("roll",z)}).on("rollNext"+a.aciCarousel.nameSpace,function(A,z){if(z){z.direction=1}else{z={direction:1}}f.trigger("roll",z)}).on("scroll"+a.aciCarousel.nameSpace,function(){});if(i.bindMouse){f.on("mousewheel"+a.aciCarousel.nameSpace,function(z,A){if(A>0){f.trigger("rollPrev")}else{f.trigger("rollNext")}return false})}if(i.bindTouch&&(typeof a.fn.swipe!="undefined")){var w=false;var s=function(C,z,B,D){if(!C.touches){return}switch(z){case"move":var A=new Date().getTime();if(!w||(w<A-250)){w=A;switch(B){case"up":if(!q){f.trigger("rollNext")}break;case"down":if(!q){f.trigger("rollPrev")}break;case"left":if(q){f.trigger("rollNext")}break;case"right":if(q){f.trigger("rollPrev")}break}}break;case"end":case"cancel":w=false;break}};f.swipe({swipeStatus:s,threshold:5,fingers:1,allowPageScroll:q?"vertical":"horizontal"})}if(i.bindKeyboard){if(i.focus){o.find(i.focus).on("click"+a.aciCarousel.nameSpace,function(){f.focus()})}f.css("outline","none").attr("tabIndex",0).on("keydown"+a.aciCarousel.nameSpace,function(z){if(!n){return}switch(z.which){case 37:if(q){f.trigger("rollPrev",{after:function(){f.focus();if(i.afterPrev){i.afterPrev()}}});return false}break;case 38:if(!q){f.trigger("rollPrev",{after:function(){f.focus();if(i.afterPrev){i.afterPrev()}}});return false}break;case 39:if(q){f.trigger("rollNext",{after:function(){f.focus();if(i.afterNext){i.afterNext()}}});return false}break;case 40:if(!q){f.trigger("rollNext",{after:function(){f.focus();if(i.afterNext){i.afterNext()}}});return false}break}})}};return h()}})(jQuery);